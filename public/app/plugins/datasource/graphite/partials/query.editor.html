<div class="tight-form">
	<ul class="tight-form-list pull-right">
		<li ng-show="ctrl.parserError" class="tight-form-item">
			<a bs-tooltip="ctrl.parserError" style="color: rgb(229, 189, 28)" role="menuitem">
				<i class="fa fa-warning"></i>
			</a>
		</li>
		<li class="tight-form-item small" ng-show="ctrl.target.datasource">
			<em>{{ctrl.target.datasource}}</em>
		</li>
		<li class="tight-form-item">
			<a class="pointer" tabindex="1" ng-click="ctrl.toggleEditorMode()">
				<i class="fa fa-pencil"></i>
			</a>
		</li>
		<li class="tight-form-item">
			<div class="dropdown">
				<a class="pointer dropdown-toggle" data-toggle="dropdown" tabindex="1">
					<i class="fa fa-bars"></i>
				</a>
				<ul class="dropdown-menu pull-right" role="menu">
					<li role="menuitem">
						<a tabindex="1" ng-click="ctrl.toggleEditorMode()">
							Switch editor mode
						</a>
					</li>
					<li role="menuitem">
						<a tabindex="1" ng-click="ctrl.duplicateQuery()">Duplicate</a>
					</li>
					<li role="menuitem">
						<a tabindex="1" ng-click="ctrl.moveQuery(-1)">Move up</a>
					</li>
					<li role="menuitem">
						<a tabindex="1" ng-click="ctrl.moveQuery(1)">Move down</a>
					</li>
				</ul>
			</div>
		</li>
		<li class="tight-form-item last">
			<a class="pointer" tabindex="1" ng-click="ctrl.removeQuery(target)">
				<i class="fa fa-remove"></i>
			</a>
		</li>
	</ul>

	<ul class="tight-form-list">
		<li class="tight-form-item" style="min-width: 15px; text-align: center">
			{{ctrl.target.refId}}
		</li>
		<li>
			<a class="tight-form-item" ng-click="ctrl.toggleHideQuery()" role="menuitem">
				<i class="fa fa-eye"></i>
			</a>
		</li>
	</ul>

	<span style="display: block; overflow: hidden;">
		<input type="text" class="tight-form-clear-input" style="width: 100%;" ng-model="ctrl.target.target" give-focus="ctrl.target.textEditor" spellcheck='false' ng-model-onblur ng-change="ctrl.refresh()" ng-show="ctrl.target.textEditor"></input>
	</span>

	<ul class="tight-form-list" role="menu" ng-hide="ctrl.target.textEditor">
		<li ng-repeat="segment in ctrl.segments" role="menuitem">
			<metric-segment segment="segment" get-options="ctrl.getAltSegments($index)" on-change="ctrl.segmentValueChanged(segment, $index)"></metric-segment>
		</li>
		<li ng-repeat="func in ctrl.functions">
			<span graphite-func-editor class="tight-form-item tight-form-func">
			</span>
		</li>
		<li class="dropdown" graphite-add-func>
		</li>
	</ul>
	<div class="clearfix"></div>
</div>
